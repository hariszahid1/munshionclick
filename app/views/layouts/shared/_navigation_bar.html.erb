<style>
.popup-overlay {
  /*Hides pop-up when there is no "active" class*/
  visibility: hidden;
  background: #ffffff;
  position: fixed;
  border-radius: 8px;
  right: 100px;
  bottom: 105px;
  width: 35%;
  height: 50%;
  box-shadow: 0 3px 10px rgb(0 0 0 / 0.2);

}

.popup-overlay.active {
  /*displays pop-up when "active" class is present*/
  visibility: visible;
  text-align: center;
}

.popup-content {
  /*Hides pop-up content when there is no "active" class */
  visibility: hidden;
}

.popup-content.active {
  /*Shows pop-up content when "active" class is present */
  visibility: visible;


}
div.popup-content{
  overflow-y: auto;
}

ul li a.active{
  color: black;
  background-color: orange;
  border-radius: 30px;
}

</style>


<nav class="navbar navbar-top py-3 justify-content-center" style="background-color: #f2f2f7">
  <h4 class="ml-3"><%= admin_name_on_nav %></h4>
  <svg version="1.1" id="Layer_1" class="cursor-pointer sidebar-toggle-icon d-none d-lg-block mx-5" style="margin-top: -10px;" height="50px" width="40px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 455 455" style="enable-background:new 0 0 455 455;" xml:space="preserve"><g><rect y="312.5" width="455" height="50"/><rect y="212.5" width="455" height="50"/><rect y="112.5" width="455" height="50"/></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g>
  </svg>
  <svg version="1.1" id="Layer_1" class="cursor-pointer sidebar-toggle-icon-mobile d-block d-lg-none mx-3" style="margin-top: -10px;" height="50px" width="40px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 455 455" style="enable-background:new 0 0 455 455;" xml:space="preserve"><g><rect y="312.5" width="455" height="50"/><rect y="212.5" width="455" height="50"/><rect y="112.5" width="455" height="50"/></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g>
  </svg>
    <% if check_is_hidden_by_module('crms')%>
      <span class = "text-light my_follow_btn open" title= "Follow Up" style="cursor: pointer; height: 20px;">
        <i class="fa fa-bell fa-4x p-3 mt-1 card shadow-lg" style="border-radius: 80px; background-color: #0f1d59;" aria-hidden="true"></i>
        <% if @follow_up_unread_count.positive? %>
          <span class = "badge rounded-pill badge-notification bg-danger text-light p-2 follow_num my_blinker" ><%= @follow_up_unread_count %></span>
          <% else %>
          <span class = "badge rounded-pill badge-notification bg-info text-dark p-2 follow_num" ><%= @follow_up_unread_count %></span>
        <% end %>
      </span>
    <% end %>

      <div class="popup-overlay card" style="background-color: rgb(255, 255, 255);">
        <div class="modal-header" >
          <h4 class="modal-title">Follow Up</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <ul class="nav navbar text-decoration-none" style="background-color: #0f1d59; color: white;"  role="tablist">
           <li class="nav-item">
              <a class="nav-link tab-label active" data-toggle="tab" href="#all" data-remote="true" role="tab">All</a>
            </li>
            <li class="nav-item">
              <a class="nav-link tab-label" data-toggle="tab" href="#unread" role="tab">Unread</a>
            </li>
            <button class='follow_ups_unread_ids d-none', value="<%= @follow_up_unread.pluck(:id) %>"></button>
            <div class="icon-container-1 ml-auto">
              <div class="my-icon-1 my-view-1">
                <div class="my-tooltip-1">
                  <div class="icon-container">
                    <div class="my-icon my-view">
                      <div class="my-tooltip">
                        Read All
                      </div>
                      <div class= "icon-div text-info read-all-button">
                        <i class="fa fa-envelope-open mt-2" aria-hidden="true"></i>
                      </div>
                    </div>
                  </div>
                </div>
                <span class="icon-div-1 text-dark">
                  <i class="fa fa-ellipsis-v mt-2" aria-hidden="true"></i>
                </span>
              </div>
            </div>
          </ul>
        <!--Creates the popup content-->
        <div class="popup-content" >
          <div class="tab-content mb-3" >
            <div class="tab-pane active" style="outline: none !important; border: none;" id="all" role="tabpanel">
              <% @follow_up_all.each do |follow_up|%>
                <%= link_to read_follow_up_path(follow_up_id: follow_up.id) do %>
                  <div class="text-decoration-none text-left pl-2 py-3 d-flex border-bottom <%= follow_up.is_read? ? '' : 'bg-unread-color'%>">
                    <div class='col-3 mt-2'>
                      <span class="badge badge-danger p-2 mb-2"><%= follow_up.priority %></span><br>
                      <span class="badge badge-primary p-2"><%= follow_up.task_type %></span>
                    </div>
                    <div class='col-9'>
                      <span class="h6"><%= follow_up&.followable&.name %></span><br>
                      <%= follow_up.comment %><br>
                      <span><%= follow_up.date.strftime('%d/%m/%Y %H:%M %p')%></span>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>

            <div class="tab-pane card" style="outline: none !important; border: none;" id="unread" role="tabpanel">
              <% @follow_up_unread.each do |follow_up|%>
                <%= link_to read_follow_up_path(follow_up_id: follow_up.id) do %>
                  <div class="text-decoration-none text-left pl-2 py-3 d-flex border-bottom bg-unread-color unread-data-container">
                    <div class='col-3 mt-2'>
                      <span class="badge badge-danger p-2 mb-2"><%= follow_up.priority %></span><br>
                      <span class="badge badge-primary p-2"><%= follow_up.task_type %></span>
                    </div>
                    <div class='col-9'>
                      <span class="h6"><%= follow_up&.followable&.name %></span><br>
                      <%= follow_up.comment %><br>
                      <span><%= follow_up.date.strftime('%d/%m/%Y %H:%M %p')%></span>
                    </div>
                  </div>
                <% end %>
              <% end %>
              <% unless @follow_up_unread.present? %>
                <p class='text-danger mt-2'>No unread follow ups exists.</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex mr-auto">
          <div class="d-none d-lg-block col mr-auto mb-2 mt-2">
            <span>
              <div class="dropdown my-nav-dropdown">
                <button type="button" class="p-3 card d-flex shadow" style="width: 350px; background-color: #f2f2f7; color: black;"><span class="d-flex mx-auto"><span class="mr-2"><i class="fas fa-hand-holding-usd fa-1x mr-2" aria-hidden="true"></i>Cash in Hand:</span><b><%=@account_amount_total.to_i%></b></span></button>
                <div class="dropdown-content my-nav-dropdown-content p-3 border-radius-1">
                    <%@account_balance.each do |account|%>
                        <i class="fas fa-check" aria-hidden="true"></i>
                          <%=account&.first%> <%=account&.last%><br>
                    <%end%>
                </div>
              </div>
            </span>
          </div>
      </div>

      <div class="d-flex ml-auto ml-4">
          <div class="d-none d-lg-block col mx-auto mb-2 mt-2">
            <span class="d-flex card p-3 shadow" style="width: 300px; background-color: #f2f2f7; color: black;">
              <span class="d-flex mx-auto"><i class="fas fa-credit-card fa-1x mr-1" aria-hidden="true"></i>Account Balance: <b><%= @total_cash %></b></span>
            </span>
          </div>
      </div>


      <div class="d-flex mx-auto">
          <%# <div class="navbar-tabs d-none d-lg-block">
            <strong class="text-danger">
              <%# Hosting Expiry Date <span id="expiryDateDisplay"><%=check_expiry_date(@pos_setting)%>
            <%# </strong>
          </div> %>
          <div class="d-none d-block d-lg-none col mr-auto mb-2 mt-2">
            <span>
              <div class="dropdown my-nav-dropdown">
                <button type="button" class="p-3 card d-flex shadow" style="width: 350px; background-color: #f2f2f7; color: black;"><span class="d-flex mx-auto"><span class="mr-2"><i class="fas fa-hand-holding-usd fa-1x mr-2" aria-hidden="true"></i>Cash in Hand:</span><b><%=@account_amount_total.to_i%></b></span></button>
                <div class="dropdown-content my-nav-dropdown-content p-3 border-radius-1">
                    <span>Account Balance:<%= @total_cash %></span><br>
                    <%@account_balance.each do |account|%>
                        <i class="fas fa-check" aria-hidden="true"></i>
                          <%=account&.first%> <%=account&.last%><br>
                    <%end%>
                </div>
              </div>
            </span>
          </div>
      </div>



      <div class="d-flex ml-auto">
       <div class="d-lg-block col ml-auto mb-2 mt-2">
            <span>
              <div class="dropdown my-nav-dropdown ">
                <button type="button" class="p-2 card d-flex shadow" style="width: 280px; background-color: #f2f2f7; color: black;"> <span class="d-flex mx-auto">
                <i class="fas fa-user-circle fa-2x" aria-hidden="true"></i>
                <span class="ml-2 mt-1"><%= current_user.name %></span></span>
                </button>
                <div class="dropdown-content my-nav-dropdown-content dropdown-content-1 p-3 border-radius-1">
                    <% if check_is_hidden_by_module('pos_settings') %>
                      <%= link_to edit_user_path(current_user.id), style:"width: 240px;", class: "btn bg-primary text-light mb-2" do %>
                        <i class="fas fa-edit" aria-hidden="true"></i>
                          <span class="link-text">Edit Profile</span>
                      <% end %>
                      <%= link_to edit_pos_setting_path(@pos_setting), style:"width: 240px;", class: "btn bg-info text-light mb-2" do %>
                        <i class="fas fa-cogs" aria-hidden="true"></i>
                          <span class="link-text">General Settings</span>
                      <% end %>
                    <% end %>
                     <%= link_to 'Logout', destroy_user_session_path, method: :delete, style:"width: 240px;", class: "btn bg-danger text-light" %>
                </div>
              </div>
            </span>
          </div>
      </div>
</nav>

<script>

  $(".open").on("click", function() {
    $(".popup-overlay, .popup-content").addClass("active");
  });

  //removes the "active" class to .popup and .popup-content when the "Close" button is clicked
  $(".close").on("click", function() {
    $(".popup-overlay, .popup-content").removeClass("active");
  });

  $(".read-all-button").click(function(){
    var ids = $('.follow_ups_unread_ids').val();
    var elements = $('.bg-unread-color')
    var unread_elems = $('.unread-data-container')
    $.ajax({
      type: "post",
      url: `/read_all`,
      data: {'ids': ids },
      success: function (result) {
        elements.removeClass('bg-unread-color')
        unread_elems.removeClass('d-flex').addClass('d-none')
        $('.my_blinker').addClass('d-none')
      },
      error: function (error){
        console.error(error)
      }
    });
  })



</script>
