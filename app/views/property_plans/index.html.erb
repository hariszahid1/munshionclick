<div class="hidden" id="city_list">
  <div class="row">
    <div class="col-lg-12 col-sm-12">
      <h1>Advance Payments</h1>
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="row">
    <div class="col-lg-12 col-sm-12">
      <div class="col-lg-12 form-group float-left">
        <textarea name="sms_msg" class="form-control" ><%=@phone%></textarea>
      </div>

      <%= search_form_for @q, url: property_plans_path, class: "admin-controls", method: "get" do |f| %>
        <div class="col-lg-3 form-group float-left">
          <%= f.select :order_sys_user_id_eq, options_from_collection_for_select(@customers, 'id', 'name', f.object.order_sys_user_id_eq),{:include_blank => "Select Customer"},class: 'form-control chosen-select'%>
        </div>
        <div class="col-lg-2 form-group float-left">
          <%= f.search_field :due_date_gteq,class: 'form-control input-sm datepicker' ,placeholder: "YYYY-MM-DD"%>
        </div>
        <div class="col-lg-2 form-group float-left">
          <%= f.search_field :due_date_lteq,class: 'form-control input-sm datepicker' ,placeholder: "YYYY-MM-DD"%>
        </div>
        <div class="col-lg-2 form-group float-left">
          <button class="form-control btn btn-primary" name="search_submit" type="submit" value="Search" style="width:100px"><i class="fa fa-search"></i></button>
        </div>
        <div class="col-lg-2 form-group float-right">
          <button class="form-control btn btn-secondary" name="submit_pdf" type="submit" value="PDF A4" formtarget="_blank"><i class="fa fa-print"></i></button>
        </div>
      <% end %>
    </div>
  </div>
  <table data-toggle="table" data-search="true">
    <thead>
      <tr>
        <th><%= sort_link(@q, :property_type, 'User') %></th>
        <th><%= sort_link(@q, :property_type, 'Phone') %></th>
        <th><%= sort_link(@q, :area_in_marla, 'Plot') %></th>
        <th><%= sort_link(@q, :area_in_marla, 'Last Payment') %></th>
        <th><%= sort_link(@q, :area_in_marla, 'Last Payment Date') %></th>
        <th><%= sort_link(@q, :price_per_marla, 'Advance') %></th>
        <th><%= sort_link(@q, :area_in_marla, 'Size') %></th>
        <th><%= sort_link(@q, :area_in_marla, 'Due Date') %></th>
        <th>Dealer</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <% @property_plans.each do |property_plan| %>
        <tr>
          <td><%= link_to property_plan.order&.sys_user&.name, orders_path('q[sys_user_id_eq]': property_plan.order&.sys_user.id.to_s,"sale":true) if property_plan.order&.sys_user&.id.present?%></td>
          <td><%= property_plan.order&.sys_user&.contact&.phone %></td>
          <td><%= property_plan.order&.order_items_names_and_quantity&.first&.first %></td>
          <td><%= number_with_delimiter property_plan.order&.sys_user&.ledger_books.where('credit>0')&.last&.credit %></td>
          <td><%= property_plan.order&.sys_user&.ledger_books.where('credit>0')&.last&.created_at&.strftime("%d%b%y at %I:%M%p")%></td>
          <td><%= number_with_delimiter property_plan.advance %></td>
          <td><%= property_plan.order&.order_items_names_and_quantity&.first[8]%>-M <%= property_plan.order&.order_items_names_and_quantity&.first[9]%>-sqr</td>
          <td><%= property_plan.due_date.present? ? property_plan.due_date.strftime("%d%b%y at %I:%M%p") : '' %></td>
          <td><%= property_plan&.order&.order_plot_dealer&.first&.staff&.name%></td>
          <td>
            <% if property_plan.order.present? %>
              <%= link_to order_path(property_plan&.order,product: true) do %>
                <i class="fa fa-eye " aria-hidden="true"></i> |
              <%end %>
            <%end %>

            <% if can?(:update, Product) %>

            <% if property_plan.order.present? %>
              <%= link_to edit_order_path(property_plan&.order,product: true) do %>
                <i class="fa fa-edit " aria-hidden="true"></i>
              <%end %>
            <%end %>
            <% end %>
          </td>
        </tr>
      <% end %>
      <tr>
        <td>Total</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td><h4><%= number_with_delimiter @total_advance%></h4></td>
      </tr>
    </tbody>
  </table>
</div>

<div class="clearfix"></div>
<div class="row">
  <div class="col-lg-4 col-sm-4">
    <%= page_entries_info @property_plans %>
  </div>
  <div class="col-lg-8 col-sm-8 pagination-left">
    <%= paginate @property_plans %>
  </div>
</div>

<script>
  $(document).ready(function() {
    if ($(".bootstrap-table").length == 0){
      $("table").bootstrapTable();
    }
    $("#city_list").removeClass('hidden');
    FontAwesome.dom.i2svg();
  });
</script>
